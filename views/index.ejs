<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Branch Switcher</title>
    <style>
    [v-cloak]{
        display:none;
    }
    </style>
    <link href="https://cdn.bootcss.com/bulma/0.7.1/css/bulma.min.css" rel="stylesheet">
</head>

<body>
    <div id='app' v-cloak>
        <nav id="navbar" class="navbar has-shadow is-spaced">
            <div class="container">
                <div class="navbar-brand">
                    <a class="navbar-item">
                        <img src="/imgs/logo.png">
                    </a>
                    <a class="navbar-item">
                        <h1>Branch Switcher</h1>
                    </a>
                </div>
            </div>
        </nav>

        <main>
            <section class="hero" :class="[is_ok?'is-primary':'is-danger']">
                <div class="hero-body">
                    <div class="container">
                        <h1 class="title">
                            <div>
                                应用：[ {{app_name}} ] <span v-if='is_show_branch'>分支策略：[{{branch}}] </span>
                                
                            </div>
                        </h1>
                        
                        <div class="subtitle">
                            {{msg}}
                        </div>
                        <div v-if='is_ok' class='subtitle'>
                            有效范围： <a :href="scope">{{scope}}</a>
                        </div>
                    </div>
                </div>
            </section>
            <div class="section container" v-if='is_show_form'>
                <div class="field">
                    <label class="label">切换分支：</label>
                    <div class="control">
                        <input v-model='branch_model' class="input" type="text" :placeholder="'当前：' + branch + ' 请输入需要切换的分支名称'">
                    </div>

                </div>
                <div class="field is-grouped">
                    <div class="control">
                        <button @click='onSubmit' class="button is-primary">确认切换</button>
                    </div>
                    <div class="control">
                        <button @click='onReset' class="button">重置为最新分支</button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="https://cdn.bootcss.com/vue/2.5.16/vue.js"></script>
    <script src="https://cdn.bootcss.com/js-cookie/latest/js.cookie.min.js"></script>
    <script>
        var branch_key = '<%= branch_key %>'
        var webroot = '<%= webroot %>'
        var code = <%= code %>
        var app_name = '<%= app_name %>'
        var msg = '<%= msg %>'
        var branch = '<%= branch %>'
        var is_ok = code === 200
        new Vue({
            el: '#app',
            data: {
                branch_model: '',
                app_name: app_name,
                webroot: webroot,
                code: code,
                msg: msg,
                is_ok: is_ok,
                branch: branch || '最新',
                scope:location.origin
            },
            computed:{
                is_show_branch(){
                    return code!==40001
                },
                is_show_form(){
                    return code!==40001
                }
            },
            methods: {
                onSubmit() {
                    if (!this.branch_model) {
                        alert('分支名不能为空')
                        return
                    }
                    Cookies.set(branch_key, this.branch_model)
                    location.reload()
                },
                onReset() {
                    Cookies.remove(branch_key)
                    location.reload()
                }
            }
        })
    </script>
</body>

</html>